<?xml version="1.0"?>
<s:ItemRenderer xmlns:fx="http://ns.adobe.com/mxml/2009"
                xmlns:s="library://ns.adobe.com/flex/spark"
                width="100%"
                minWidth="300"
                autoDrawBackground="false">
    <fx:Script><![CDATA[
        import data.PopupManager;
        import data.ProjectData;
        import data.ProjectManager;

        import global.Color;
        import global.Icons;
        import global.Util;

        import ui.popups.PopupConfirm;
        import ui.popups.PopupInput;

        private var projectData:ProjectData;

        override public function set data(value:Object):void
        {
            if (!value)
                return;

            projectData = ProjectData(value);
            labelName.text = projectData.name;
            labelDate.text = Util.toRelativeDate(projectData.date);
            labelEngine.text = "Engine Version " + projectData.engine;
        }

        private function onClickDelete(event:MouseEvent):void
        {
            var p:PopupConfirm = new PopupConfirm();
            p.callbackConfirm = projectData.remove;
            p.header = "Delete Project";
            p.description = "Are you sure you want to delete " + projectData.name + "?";
            p.textConfirm = "Delete";
            PopupManager.open(p);
        }

        private function onClickOpen(event:MouseEvent):void
        {
            ProjectManager.instance.launch(projectData);
        }

        private function onClickRename(event:MouseEvent):void
        {
            var p:PopupInput = new PopupInput();
            p.callbackConfirm = projectData.rename;
            p.validateFunction = ProjectManager.instance.validateNewName;
            p.initialInputText = projectData.name;
            p.header = "Rename Project";
            p.description = "Enter a new name for " + projectData.name + ".";
            p.textConfirm = "Rename";
            p.validateTooltip = "Project names must be unique";
            PopupManager.open(p);
        }
        ]]>
    </fx:Script>

    <s:Group width="100%">

        <s:Rect width="100%"
                height="100%"
                radiusX="5"
                radiusY="5">
            <s:fill>
                <s:SolidColor color="{Color.fillLow}"/>
            </s:fill>
        </s:Rect>

        <s:VGroup width="100%"
                  padding="15"
                  gap="15">

            <s:VGroup width="100%"
                      gap="10">

                <s:Label id="labelName"
                         width="100%"
                         styleName="header"/>

                <s:HGroup width="100%">
                    <s:Label id="labelDate"
                             width="100%"/>

                    <s:Label id="labelEngine"/>
                </s:HGroup>

            </s:VGroup>

            <s:HGroup width="100%"
                      horizontalAlign="right"
                      top="5">

                <s:Button id="buttonRename"
                          label="Rename"
                          click="onClickRename(event)"/>

                <s:Button id="buttonDelete"
                          label="Delete"
                          click="onClickDelete(event)"/>

                <s:Button id="buttonOpen"
                          skinClass="ui.skins.ButtonSkinTheme"
                          icon="{Icons.Pen}"
                          label="Open"
                          click="onClickOpen(event)"/>

            </s:HGroup>

        </s:VGroup>

    </s:Group>

</s:ItemRenderer>
